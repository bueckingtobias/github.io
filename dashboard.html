<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>B√ºcking Immobilien ‚Äì Dashboard</title>

  <!-- Dashboard nicht indexieren -->
  <meta name="robots" content="noindex, nofollow">

  <style>
    :root {
      /* DARK THEME DEFAULT */
      --bg-page: radial-gradient(circle at top left, #181b29 0, #05060a 60%);
      --bg: #05060a;
      --bg-elevated: #11131c;
      --accent: #0ea568;           /* Gr√ºn (Marke) */
      --accent-2: #1d8bff;         /* Blau */
      --accent-3: #ffb020;         /* Amber */
      --accent-4: #b15cff;         /* Lila */
      --accent-soft: rgba(14,165,104,0.16);
      --text: #f5f5f7;
      --text-soft: #a3a6b7;
      --border: #262938;
      --radius: 14px;
    }

    /* LIGHT THEME */
    :root[data-theme="light"] {
      --bg-page: #f4f5f7;
      --bg: #f4f5f7;
      --bg-elevated: #ffffff;
      --accent: #0ea568;
      --accent-2: #2563eb;
      --accent-3: #f59e0b;
      --accent-4: #8b5cf6;
      --accent-soft: rgba(14,165,104,0.12);
      --text: #111827;
      --text-soft: #6b7280;
      --border: #d1d5db;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      background: var(--bg-page);
      color: var(--text);
    }

    body {
      display: flex;
      align-items: stretch;
      justify-content: stretch;
      overflow: hidden; /* KEIN globales Scrollen, nur intern */
    }

    /* LOGIN OVERLAY */

    #login-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #151724 0, #02030a 60%);
      z-index: 20;
    }

    :root[data-theme="light"] #login-overlay {
      background: rgba(15,23,42,0.12);
    }

    .login-card {
      width: 100%;
      max-width: 380px;
      background: linear-gradient(145deg, #10121c, #171927);
      padding: 26px 24px 20px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
    }

    :root[data-theme="light"] .login-card {
      background: #ffffff;
      border-color: #e5e7eb;
      box-shadow: 0 18px 40px rgba(15,23,42,0.15);
      color: #111827;
    }

    .login-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 18px;
    }

    .logo-mark {
      width: 26px;
      height: 26px;
      border-radius: 9px;
      background: radial-gradient(circle at 30% 0, #2ad18b, #004225);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      color: #ffffff;
    }

    .login-title {
      font-size: 17px;
      font-weight: 600;
    }

    .login-subtitle {
      font-size: 12px;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .login-label {
      font-size: 13px;
      margin-bottom: 6px;
      margin-top: 10px;
      display: block;
    }

    .login-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(4,4,10,0.9);
      color: var(--text);
      font-size: 14px;
      outline: none;
    }

    :root[data-theme="light"] .login-input {
      background: #f9fafb;
    }

    .login-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(14,165,104,0.5);
    }

    .login-actions {
      display: flex;
      margin-top: 16px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 9px 16px;
      font-size: 14px;
      cursor: pointer;
      font-weight: 500;
    }

    .btn-primary {
      width: 100%;
      background: linear-gradient(135deg, #1f7f4b, #004225);
      color: #fff;
      box-shadow: 0 10px 18px rgba(0,0,0,0.5);
    }

    :root[data-theme="light"] .btn-primary {
      background: linear-gradient(135deg, #0ea568, #15803d);
      box-shadow: 0 8px 16px rgba(15,118,110,0.35);
    }

    .btn-primary:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }

    .login-error {
      margin-top: 10px;
      font-size: 12px;
      color: #ff4b5c;
      min-height: 18px;
    }

    .login-meta {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      opacity: 0.75;
    }

    /* APP LAYOUT */

    #app {
      display: none; /* wird nach Login sichtbar */
      width: 100%;
      min-height: 100vh;
    }

    .shell {
      display: grid;
      grid-template-columns: 220px 1fr;
      height: 100vh; /* Vollbild, kein globales Scrollen */
    }

    aside {
      background: radial-gradient(circle at top, #181a27 0, #05060b 60%);
      border-right: 1px solid rgba(255,255,255,0.06);
      padding: 16px 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    :root[data-theme="light"] aside {
      background: #111827;
      border-right-color: #1f2937;
      color: #f9fafb;
    }

    .sidebar-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .nav-section-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-soft);
      margin: 4px 3px;
    }

    .nav-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-item {
      border-radius: 999px;
      border: none;
      padding: 7px 10px;
      background: transparent;
      color: var(--text-soft);
      font-size: 13px;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: background .15s ease, transform .1s ease;
    }

    .nav-item span.icon {
      width: 18px;
      text-align: center;
    }

    .nav-item:hover {
      background: rgba(255,255,255,0.06);
      transform: translateY(-1px);
    }

    .nav-item.active {
      background: var(--accent-soft);
      color: #fff;
      box-shadow: 0 10px 20px rgba(0,0,0,0.6);
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: 11px;
      color: var(--text-soft);
      border-top: 1px solid rgba(255,255,255,0.12);
      padding-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .logout-btn {
      align-self: flex-start;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(248,113,113,0.7);
      background: rgba(248,113,113,0.08);
      color: #fecaca;
      font-size: 11px;
      cursor: pointer;
    }

    :root[data-theme="light"] .logout-btn {
      color: #b91c1c;
      background: #fee2e2;
      border-color: #fecaca;
    }

    .main {
      padding: 10px 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: hidden; /* keine √§u√üere Scrollbar, nur in Views */
      background: transparent;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 2px;
    }

    .topbar-title {
      font-size: 18px;
      font-weight: 600;
    }

    .topbar-sub {
      font-size: 12px;
      color: var(--text-soft);
    }

    .pill-row {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      font-size: 11px;
      color: var(--text-soft);
      white-space: nowrap;
      background: rgba(0,0,0,0.08);
    }

    :root[data-theme="light"] .pill {
      background: #ffffff;
      border-color: #e5e7eb;
    }

    .pill-accent {
      border-color: rgba(14,165,104,0.7);
      background: var(--accent-soft);
      color: #eafff6;
    }

    :root[data-theme="light"] .pill-accent {
      color: #065f46;
    }

    .pill-theme {
      cursor: pointer;
    }

    .view {
      display: none;
      height: calc(100vh - 70px); /* fix: nutze ganze H√∂he, aber kein globales Scrollen */
      overflow: hidden;
    }
    .view.active {
      display: block;
    }

    .card {
      background: linear-gradient(145deg, var(--bg-elevated), #090a12);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 10px 12px 10px;
      box-shadow: 0 12px 28px rgba(0,0,0,0.6);
    }

    :root[data-theme="light"] .card {
      background: #ffffff;
      border-color: #e5e7eb;
      box-shadow: 0 10px 25px rgba(15,23,42,0.08);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 6px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 2px;
    }

    .card-sub {
      font-size: 12px;
      color: var(--text-soft);
    }

    .tag {
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.07);
      font-size: 11px;
      color: var(--text-soft);
      white-space: nowrap;
    }

    :root[data-theme="light"] .tag {
      background: #f3f4f6;
      color: #4b5563;
    }

    .summary-block {
      font-size: 12px;
      color: var(--text-soft);
      margin-top: 2px;
      line-height: 1.5;
    }
    .summary-block strong { color: var(--text); }

    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 8px;
    }

    .kpi-card {
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.08);
      background: radial-gradient(circle at top, rgba(255,255,255,0.06), rgba(0,0,0,0.9));
    }

    :root[data-theme="light"] .kpi-card {
      background: linear-gradient(135deg, #ffffff, #f9fafb);
      border-color: #e5e7eb;
    }

    .kpi-label {
      font-size: 11px;
      color: var(--text-soft);
    }

    .kpi-value {
      font-size: 17px;
      font-weight: 600;
      margin: 2px 0 0;
    }

    .kpi-subline {
      font-size: 11px;
      color: var(--text-soft);
    }

    .charts-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 8px;
      height: 260px;
    }

    .chart-card {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .chart-container {
      position: relative;
      width: 100%;
      flex: 1;
      min-height: 0;
    }

    .chart-title {
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .chart-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 6px;
      height: 190px;
    }

    .chart-container.small {
      height: 150px;
    }

    .table-wrapper {
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.08);
      overflow: auto;
      margin-top: 6px;
      max-height: 210px;
    }

    :root[data-theme="light"] .table-wrapper {
      border-color: #e5e7eb;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    th, td {
      padding: 6px 8px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      white-space: nowrap;
    }

    :root[data-theme="light"] th,
    :root[data-theme="light"] td {
      border-bottom-color: #e5e7eb;
    }

    th {
      font-weight: 500;
      color: var(--text-soft);
      background: rgba(255,255,255,0.03);
    }

    :root[data-theme="light"] th {
      background: #f3f4f6;
    }

    tr:nth-child(even) td {
      background: rgba(255,255,255,0.02);
    }

    :root[data-theme="light"] tr:nth-child(even) td {
      background: #f9fafb;
    }

    .badge-status {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .badge-status.ok {
      background: rgba(16,185,129,0.18);
      color: #a0ffe0;
    }
    .badge-status.leer {
      background: rgba(148,163,184,0.25);
      color: #e5e7eb;
    }
    .badge-status.risky {
      background: rgba(248,113,113,0.18);
      color: #fecaca;
    }

    :root[data-theme="light"] .badge-status.ok {
      background: #dcfce7;
      color: #15803d;
    }
    :root[data-theme="light"] .badge-status.leer {
      background: #e5e7eb;
      color: #4b5563;
    }
    :root[data-theme="light"] .badge-status.risky {
      background: #fee2e2;
      color: #b91c1c;
    }

    .object-select-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 4px;
    }

    select {
      background: #05060b;
      color: var(--text);
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 6px 10px;
      font-size: 13px;
      outline: none;
    }

    :root[data-theme="light"] select {
      background: #f9fafb;
      border-color: #d1d5db;
      color: #111827;
    }

    /* HOME VIEW LAYOUT */
    .home-grid {
      display: grid;
      grid-template-columns: 1.3fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 8px;
      height: 100%;
    }

    .home-grid .card {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .home-body {
      flex: 1;
      min-height: 0;
      overflow: auto;
    }

    .weather-main {
      font-size: 30px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .weather-sub {
      font-size: 12px;
      color: var(--text-soft);
    }

    .news-list {
      list-style: none;
      margin: 0;
      padding: 0;
      font-size: 12px;
      display: grid;
      gap: 4px;
    }

    .news-list li a {
      color: var(--text);
      text-decoration: none;
    }

    .news-list li a:hover {
      text-decoration: underline;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 4px;
      font-size: 11px;
      margin-top: 6px;
    }

    .calendar-cell {
      padding: 4px 0;
      text-align: center;
      border-radius: 6px;
      color: var(--text-soft);
    }

    .calendar-cell.head {
      font-weight: 600;
      color: var(--text-soft);
    }

    .calendar-cell.today {
      background: var(--accent-soft);
      color: #ffffff;
      font-weight: 600;
    }

    @media (max-width: 900px) {
      .shell {
        grid-template-columns: 70px 1fr;
      }
      .sidebar-title,
      .nav-section-label,
      .sidebar-footer {
        display: none;
      }
      .nav-item span.label {
        display: none;
      }
      .nav-item {
        justify-content: center;
        padding-inline: 0;
      }
      .kpi-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .charts-grid,
      .chart-row {
        grid-template-columns: minmax(0, 1fr);
        height: auto;
      }
      .view {
        height: calc(100vh - 70px);
      }
      .home-grid {
        grid-template-columns: minmax(0, 1fr);
        grid-template-rows: auto auto auto;
      }
    }

  </style>
</head>
<body>

  <!-- LOGIN -->
  <div id="login-overlay">
    <div class="login-card">
      <div class="login-logo">
        <div class="logo-mark">BI</div>
        <div>
          <div class="login-title">B√ºcking Immobilien Dashboard</div>
          <div class="login-subtitle">Gesch√ºtzter Zugang ‚Äì interne √úbersicht.</div>
        </div>
      </div>

      <label class="login-label" for="login-password">Passwort</label>
      <input type="password" id="login-password" class="login-input" autocomplete="current-password" />

      <div class="login-actions">
        <button class="btn btn-primary" id="login-button">Login</button>
      </div>

      <div class="login-error" id="login-error"></div>
      <div class="login-meta">
        <span>Dashboard v0.4 (KPIs, Charts, Home, Theme)</span>
        <span id="login-date"></span>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div id="app">
    <div class="shell">
      <aside>
        <div class="sidebar-title">Dashboard</div>

        <div class="nav-section-label">Start</div>
        <div class="nav-list">
          <button class="nav-item active" data-view="view-home">
            <span class="icon">üè†</span><span class="label">Home</span>
          </button>
        </div>

        <div class="nav-section-label">√úbersicht</div>
        <div class="nav-list">
          <button class="nav-item" data-view="view-portfolio">
            <span class="icon">üìä</span><span class="label">Portfolio</span>
          </button>
          <button class="nav-item" data-view="view-objects">
            <span class="icon">üè¢</span><span class="label">Objekte</span>
          </button>
          <button class="nav-item" data-view="view-projects">
            <span class="icon">üõ†Ô∏è</span><span class="label">Projekte/Bau</span>
          </button>
        </div>

        <div class="nav-section-label">Finanzen</div>
        <div class="nav-list">
          <button class="nav-item" data-view="view-finance">
            <span class="icon">üí∂</span><span class="label">Finanzen</span>
          </button>
          <button class="nav-item" data-view="view-reports">
            <span class="icon">üìë</span><span class="label">Reports</span>
          </button>
        </div>

        <div class="nav-section-label">System</div>
        <div class="nav-list">
          <button class="nav-item" data-view="view-settings">
            <span class="icon">‚öôÔ∏è</span><span class="label">Einstellungen</span>
          </button>
        </div>

        <div class="sidebar-footer">
          <button class="logout-btn" id="logout-btn">Logout</button>
          <div>Angemeldet als: Gesch√§ftsf√ºhrung</div>
          <div style="font-size:10px;">Daten & Prognosen: Dummy-Basis.</div>
        </div>
      </aside>

      <main class="main">
        <div class="topbar">
          <div>
            <div class="topbar-title" id="topbar-title">Home</div>
            <div class="topbar-sub" id="topbar-sub">√úbersicht: Wetter, Kalender & Branchen-News.</div>
          </div>
          <div class="pill-row">
            <span class="pill" id="topbar-date"></span>
            <span class="pill pill-accent">B√ºcking Immobilien</span>
            <span class="pill pill-theme" id="theme-pill">Modus: Dunkel</span>
          </div>
        </div>

        <!-- HOME VIEW -->
        <section class="view active" id="view-home">
          <div class="home-grid">
            <!-- Wetter & Kurzinfos -->
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">Wetter & Tages√ºberblick</div>
                  <div class="card-sub">Region Ganderkesee / Bremen ‚Äì Live aus Open-Meteo.</div>
                </div>
                <span class="tag" id="weather-location-tag">l√§dt ‚Ä¶</span>
              </div>
              <div class="home-body" id="weather-content">
                <!-- wird per JS gef√ºllt -->
              </div>
            </div>

            <!-- Kalender -->
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">Kalender</div>
                  <div class="card-sub">Aktueller Monat, Fokus auf heute.</div>
                </div>
              </div>
              <div class="home-body">
                <div class="summary-block" id="calendar-header"></div>
                <div class="calendar-grid" id="calendar-grid"></div>
              </div>
            </div>

            <!-- Branchen-News -->
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">News ‚Äì Immobilien & Bau</div>
                  <div class="card-sub">Versuch, aktuelle Headlines aus RSS zu ziehen ‚Äì sonst Dummy.</div>
                </div>
                <span class="tag" id="news-status">l√§dt ‚Ä¶</span>
              </div>
              <div class="home-body">
                <ul class="news-list" id="news-list"></ul>
              </div>
            </div>

            <!-- Quick KPIs -->
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">Schnell-√úberblick</div>
                  <div class="card-sub">Kerneckdaten auf einen Blick.</div>
                </div>
              </div>
              <div class="home-body">
                <div class="kpi-grid">
                  <div class="kpi-card" style="border-top:3px solid var(--accent);">
                    <div class="kpi-label">Monats-CF (netto)</div>
                    <div class="kpi-value" id="home-kpi-cf"></div>
                    <div class="kpi-subline">Tendenz 12M (Dummy)</div>
                  </div>
                  <div class="kpi-card" style="border-top:3px solid var(--accent-2);">
                    <div class="kpi-label">Miete (p.m.)</div>
                    <div class="kpi-value" id="home-kpi-rent"></div>
                    <div class="kpi-subline">Ist vs. Potenzial</div>
                  </div>
                  <div class="kpi-card" style="border-top:3px solid var(--accent-3);">
                    <div class="kpi-label">Leerstand</div>
                    <div class="kpi-value" id="home-kpi-vacancy"></div>
                    <div class="kpi-subline">Fl√§chenanteil</div>
                  </div>
                  <div class="kpi-card" style="border-top:3px solid var(--accent-4);">
                    <div class="kpi-label">Portfolio-ROI</div>
                    <div class="kpi-value" id="home-kpi-roi"></div>
                    <div class="kpi-subline">Cash-on-Cash (Dummy)</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- PORTFOLIO VIEW -->
        <section class="view" id="view-portfolio">
          <!-- KPI Zeile -->
          <div class="card" style="margin-bottom:8px;">
            <div class="card-header">
              <div>
                <div class="card-title">Portfolio-KPIs</div>
                <div class="card-sub">Verdichtete Steuerungskennzahlen aus allen Objekten.</div>
              </div>
              <span class="tag" id="portfolio-object-count-tag"></span>
            </div>
            <div class="kpi-grid">
              <div class="kpi-card" style="border-left:3px solid var(--accent);">
                <div class="kpi-label">Monats-Cashflow (netto)</div>
                <div class="kpi-value" id="kpi-monthly-cf"></div>
                <div class="kpi-subline" id="kpi-monthly-cf-sub"></div>
              </div>
              <div class="kpi-card" style="border-left:3px solid var(--accent-2);">
                <div class="kpi-label">Miete gesamt (p.m.)</div>
                <div class="kpi-value" id="kpi-rent-total"></div>
                <div class="kpi-subline" id="kpi-rent-total-sub"></div>
              </div>
              <div class="kpi-card" style="border-left:3px solid var(--accent-3);">
                <div class="kpi-label">Leerstand Fl√§che</div>
                <div class="kpi-value" id="kpi-vacancy"></div>
                <div class="kpi-subline" id="kpi-vacancy-sub"></div>
              </div>
              <div class="kpi-card" style="border-left:3px solid var(--accent-4);">
                <div class="kpi-label">Portfolio-ROI</div>
                <div class="kpi-value" id="kpi-avg-roi"></div>
                <div class="kpi-subline" id="kpi-equity-total"></div>
              </div>
            </div>
          </div>

          <!-- Charts: CF + Miete -->
          <div class="charts-grid">
            <div class="card chart-card">
              <div class="card-header">
                <div>
                  <div class="card-title">Cashflow-Verlauf & Prognose</div>
                  <div class="card-sub">12M Historie + 6M Forecast (Dummy).</div>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="chart-cashflow"></canvas>
              </div>
            </div>
            <div class="card chart-card">
              <div class="card-header">
                <div>
                  <div class="card-title">Miete je Objekt</div>
                  <div class="card-sub">Aktuelle Monatsmiete pro Objekt.</div>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="chart-rent-per-object"></canvas>
              </div>
            </div>
          </div>

          <!-- Charts: ROI + Belegung -->
          <div class="charts-grid">
            <div class="card chart-card">
              <div class="card-header">
                <div>
                  <div class="card-title">ROI je Objekt</div>
                  <div class="card-sub">Cash-on-Cash-Rendite pro Objekt.</div>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="chart-roi-per-object"></canvas>
              </div>
            </div>
            <div class="card chart-card">
              <div class="card-header">
                <div>
                  <div class="card-title">Belegung vs. Leerstand</div>
                  <div class="card-sub">Fl√§chengewichtete Verteilung im Portfolio.</div>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="chart-vacancy"></canvas>
              </div>
            </div>
          </div>

          <!-- Objekt-Tabelle unten -->
          <div class="card" style="height:140px; margin-top:4px; display:flex; flex-direction:column;">
            <div class="card-header">
              <div>
                <div class="card-title">Objekt√ºbersicht</div>
                <div class="card-sub">Klick auf Objekt ‚Üí Detailansicht.</div>
              </div>
            </div>
            <div class="table-wrapper" style="flex:1;">
              <table>
                <thead>
                  <tr>
                    <th>Objekt</th>
                    <th>Ort</th>
                    <th>Miete (p.m.)</th>
                    <th>Leerstand</th>
                    <th>ROI</th>
                    <th>Fl√§che</th>
                  </tr>
                </thead>
                <tbody id="portfolio-objects-tbody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- OBJECTS VIEW -->
        <section class="view" id="view-objects">
          <div class="card" style="display:flex; flex-direction:column; gap:6px; height:100%;">
            <div class="card-header">
              <div>
                <div class="card-title">Objekte & Mieter</div>
                <div class="card-sub">Objektebene inkl. KPIs, Charts & Einheitenliste.</div>
              </div>
            </div>

            <div class="object-select-row">
              <label for="object-select" style="font-size:12px;">Objekt:</label>
              <select id="object-select"></select>
              <span class="pill" id="object-meta-pill"></span>
            </div>

            <div class="summary-block" id="object-summary"></div>

            <!-- Objektbezogene Charts -->
            <div class="chart-row">
              <div class="card chart-card" style="height:100%;">
                <div class="chart-title">Miete Ist vs. Potenzial (+ Prognose)</div>
                <div class="chart-container small">
                  <canvas id="chart-object-rent"></canvas>
                </div>
              </div>
              <div class="card chart-card" style="height:100%;">
                <div class="chart-title">Belegung (vermietet vs. leer)</div>
                <div class="chart-container small">
                  <canvas id="chart-object-occupancy"></canvas>
                </div>
              </div>
            </div>

            <!-- Einheiten / Mieter Tabelle -->
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Einheit</th>
                    <th>Etage</th>
                    <th>Fl√§che</th>
                    <th>Status</th>
                    <th>Mieter</th>
                    <th>Kaltmiete</th>
                    <th>NK</th>
                    <th>Zahlung</th>
                  </tr>
                </thead>
                <tbody id="units-tbody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- PROJECTS VIEW -->
        <section class="view" id="view-projects">
          <div class="card" style="height:100%; display:flex; flex-direction:column;">
            <div class="card-header">
              <div>
                <div class="card-title">Projekte / Bau</div>
                <div class="card-sub">Bau- und Projektcontrolling mit Budget, Kosten & Abweichung.</div>
              </div>
            </div>
            <div class="table-wrapper" style="flex:1;">
              <table>
                <thead>
                  <tr>
                    <th>Projekt</th>
                    <th>Objekt</th>
                    <th>Status</th>
                    <th>Budget</th>
                    <th>Kosten bisher</th>
                    <th>Abweichung</th>
                  </tr>
                </thead>
                <tbody id="projects-tbody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- FINANCE VIEW -->
        <section class="view" id="view-finance">
          <div class="card" style="height:100%; display:flex; flex-direction:column; gap:6px;">
            <div class="card-header">
              <div>
                <div class="card-title">Finanzen</div>
                <div class="card-sub">Cashflow, Eigenkapital & Portfolio-ROI aus den Dummy-Daten.</div>
              </div>
            </div>
            <div class="summary-block" id="finance-summary"></div>
          </div>
        </section>

        <!-- REPORTS VIEW -->
        <section class="view" id="view-reports">
          <div class="card" style="height:100%; display:flex; flex-direction:column; gap:6px;">
            <div class="card-header">
              <div>
                <div class="card-title">Reports</div>
                <div class="card-sub">Platzhalter f√ºr Exportfunktionen & Bankreports.</div>
              </div>
            </div>
            <div class="summary-block">
              Sp√§ter m√∂glich:<br>
              ‚Ä¢ Monatsreport pro Objekt (PDF)<br>
              ‚Ä¢ Portfolio-√úbersicht f√ºr Bank / Finanzierungsgespr√§che<br>
              ‚Ä¢ Export der Mieter-/Einheitenliste als CSV.
            </div>
          </div>
        </section>

        <!-- SETTINGS VIEW -->
        <section class="view" id="view-settings">
          <div class="card" style="height:100%; display:flex; flex-direction:column; gap:6px;">
            <div class="card-header">
              <div>
                <div class="card-title">Einstellungen</div>
                <div class="card-sub">Theme & System. (Datenpflege sp√§ter)</div>
              </div>
            </div>
            <div class="summary-block">
              <strong>Design & Modus</strong><br>
              <div style="margin-top:4px; display:flex; gap:8px; flex-wrap:wrap;">
                <button class="btn" id="btn-theme-dark" style="font-size:12px; padding:6px 12px;">Dunkelmodus</button>
                <button class="btn" id="btn-theme-light" style="font-size:12px; padding:6px 12px;">Hellmodus</button>
              </div>
              <div style="margin-top:8px; font-size:11px;">
                ‚Ä¢ Auswahl wird lokal gespeichert und beim n√§chsten √ñffnen wiederverwendet.<br>
                ‚Ä¢ Charts passen Achsenfarben automatisch an.
              </div>
              <br>
              <strong>Sp√§ter m√∂glich:</strong><br>
              ‚Ä¢ Objekte & Einheiten pflegen<br>
              ‚Ä¢ Benutzer/Rollen definieren<br>
              ‚Ä¢ Schnittstellen (Bank, Hausverwalter, CSV-Import) anbinden.
            </div>
          </div>
        </section>

      </main>
    </div>
  </div>

  <!-- Chart.js von CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // ===== Passwort festgelegt =====
    const PASSWORD = "BI_Dashboard_2025";

    // ===== Dummy-Datenstruktur =====
    const DATA = {
      objects: [
        {
          id: "hof-ganderkesee",
          name: "Hof Ganderkesee",
          city: "Ganderkesee",
          totalArea: 1150,
          monthlyRentActual: 32400,
          monthlyRentPotential: 33800,
          vacancyUnits: 1,
          vacancyArea: 65,
          roi: 8.4,
          equity: 1250000,
          cashflowYear: 105000,
          units: [
            {
              name: "Whg 1 | EG links",
              floor: "EG",
              area: 78,
              status: "vermietet",
              tenant: "M. Beispiel",
              rent: 980,
              nk: 240,
              paymentStatus: "p√ºnktlich"
            },
            {
              name: "Whg 2 | EG rechts",
              floor: "EG",
              area: 82,
              status: "leer",
              tenant: "",
              rent: 1050,
              nk: 260,
              paymentStatus: ""
            },
            {
              name: "Whg 3 | OG links",
              floor: "OG",
              area: 94,
              status: "vermietet",
              tenant: "F. Mieter",
              rent: 1280,
              nk: 290,
              paymentStatus: "R√ºckstand"
            }
          ],
          projects: [
            {
              id: "p-ausbau-scheune",
              name: "Ausbau Scheune",
              status: "laufend",
              budget: 1100000,
              spent: 630000,
              deviationPercent: 2
            }
          ]
        },
        {
          id: "neubau-syke",
          name: "Neubau Syke",
          city: "Syke",
          totalArea: 840,
          monthlyRentActual: 18200,
          monthlyRentPotential: 20500,
          vacancyUnits: 2,
          vacancyArea: 90,
          roi: 7.1,
          equity: 950000,
          cashflowYear: 68000,
          units: [
            {
              name: "Whg 1 | Haus A",
              floor: "EG",
              area: 70,
              status: "vermietet",
              tenant: "A. Mustermann",
              rent: 1100,
              nk: 230,
              paymentStatus: "p√ºnktlich"
            },
            {
              name: "Whg 2 | Haus A",
              floor: "OG",
              area: 75,
              status: "leer",
              tenant: "",
              rent: 1200,
              nk: 240,
              paymentStatus: ""
            }
          ],
          projects: [
            {
              id: "p-neubau-haus-b",
              name: "Neubau Haus B",
              status: "kritisch",
              budget: 2400000,
              spent: 1280000,
              deviationPercent: 8
            }
          ]
        },
        {
          id: "stadtvilla-bremen",
          name: "Stadtvilla Bremen",
          city: "Bremen",
          totalArea: 520,
          monthlyRentActual: 11600,
          monthlyRentPotential: 11600,
          vacancyUnits: 0,
          vacancyArea: 0,
          roi: 6.3,
          equity: 600000,
          cashflowYear: 38000,
          units: [
            {
              name: "Whg 1 | 1. OG",
              floor: "1. OG",
              area: 120,
              status: "vermietet",
              tenant: "Familie Hanse",
              rent: 1950,
              nk: 320,
              paymentStatus: "p√ºnktlich"
            }
          ],
          projects: [
            {
              id: "p-fassade-dach",
              name: "Fassade & Dach",
              status: "abgeschlossen",
              budget: 280000,
              spent: 280000,
              deviationPercent: 0
            }
          ]
        }
      ]
    };

    // ===== Utility-Funktionen =====
    function formatEuro(value) {
      return value.toLocaleString("de-DE", { minimumFractionDigits: 0 }) + " ‚Ç¨";
    }

    function formatPercent(value) {
      return value.toLocaleString("de-DE", { maximumFractionDigits: 1 }) + " %";
    }

    function formatArea(value) {
      return value.toLocaleString("de-DE", { maximumFractionDigits: 0 }) + " m¬≤";
    }

    function formatDeviation(deviationPercent) {
      const sign = deviationPercent > 0 ? "+" : "";
      return sign + deviationPercent.toLocaleString("de-DE", { maximumFractionDigits: 1 }) + " %";
    }

    // ===== Theme Handling =====
    function applyTheme(theme) {
      const root = document.documentElement;
      if (theme !== "light" && theme !== "dark") theme = "dark";
      root.setAttribute("data-theme", theme);
      localStorage.setItem("bi_dashboard_theme", theme);
      const pill = document.getElementById("theme-pill");
      if (pill) pill.textContent = "Modus: " + (theme === "dark" ? "Dunkel" : "Hell");
      updateChartTheme(theme);
    }

    function initTheme() {
      const stored = localStorage.getItem("bi_dashboard_theme") || "dark";
      applyTheme(stored);
    }

    // ===== Passwortschutz / Login =====
    const loginOverlay = document.getElementById("login-overlay");
    const loginInput = document.getElementById("login-password");
    const loginButton = document.getElementById("login-button");
    const loginError = document.getElementById("login-error");
    const loginDate = document.getElementById("login-date");
    const app = document.getElementById("app");
    const logoutBtn = document.getElementById("logout-btn");

    function formatDate(d) {
      return d.toLocaleDateString("de-DE", {
        weekday: "short",
        day: "2-digit",
        month: "2-digit",
        year: "numeric"
      });
    }

    loginDate.textContent = formatDate(new Date());

    function openApp() {
      loginOverlay.style.display = "none";
      app.style.display = "block";
      localStorage.setItem("bi_dashboard_logged_in", "1");
    }

    function handleLogin() {
      const value = (loginInput.value || "").trim();
      if (!value) {
        loginError.textContent = "Bitte Passwort eingeben.";
        return;
      }
      if (value === PASSWORD) {
        loginError.textContent = "";
        openApp();
      } else {
        loginError.textContent = "Falsches Passwort.";
      }
    }

    loginButton.addEventListener("click", handleLogin);
    loginInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") handleLogin();
    });

    if (logoutBtn) {
      logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("bi_dashboard_logged_in");
        location.reload();
      });
    }

    // auto-login falls schon eingeloggter Zustand
    if (localStorage.getItem("bi_dashboard_logged_in") === "1") {
      openApp();
    }

    // ===== Navigation =====
    const navItems = document.querySelectorAll(".nav-item");
    const views = document.querySelectorAll(".view");
    const topbarTitle = document.getElementById("topbar-title");
    const topbarSub = document.getElementById("topbar-sub");
    const topbarDate = document.getElementById("topbar-date");

    topbarDate.textContent = formatDate(new Date());

    const VIEW_TEXT = {
      "view-home": {
        title: "Home",
        sub: "√úbersicht: Wetter, Kalender & Branchen-News."
      },
      "view-portfolio": {
        title: "Portfolio-Cockpit",
        sub: "√úberblick √ºber alle Objekte & Kennzahlen (Dummy-Daten)."
      },
      "view-objects": {
        title: "Objekte & Mieter",
        sub: "Objektebene mit Einheiten- & Mieter√ºbersicht."
      },
      "view-projects": {
        title: "Projekte / Bau",
        sub: "Bauprojekte und Gewerke im √úberblick."
      },
      "view-finance": {
        title: "Finanzen",
        sub: "Aggregierte Finanzkennzahlen aus den Objekt-Daten."
      },
      "view-reports": {
        title: "Reports",
        sub: "Platzhalter f√ºr Reporting & Exporte."
      },
      "view-settings": {
        title: "Einstellungen",
        sub: "Theme & System (weitere Funktionen folgen)."
      }
    };

    function activateView(viewId) {
      navItems.forEach(n => {
        if (n.getAttribute("data-view") === viewId) n.classList.add("active");
        else n.classList.remove("active");
      });
      views.forEach(v => {
        if (v.id === viewId) v.classList.add("active");
        else v.classList.remove("active");
      });
      const cfg = VIEW_TEXT[viewId];
      if (cfg) {
        topbarTitle.textContent = cfg.title;
        topbarSub.textContent = cfg.sub;
      }
    }

    navItems.forEach(item => {
      item.addEventListener("click", () => {
        const viewId = item.getAttribute("data-view");
        activateView(viewId);
      });
    });

    // ===== Charts Referenzen =====
    let cashflowChart, rentPerObjectChart, roiPerObjectChart, vacancyChart;
    let objectRentChart, objectOccupancyChart;

    // ===== Portfolio aus Daten f√ºllen =====
    function initPortfolioView() {
      const objects = DATA.objects;
      const objectCount = objects.length;

      const totalMonthlyCF = objects.reduce((sum, obj) => sum + obj.cashflowYear / 12, 0);
      const totalMonthlyRent = objects.reduce((sum, obj) => sum + obj.monthlyRentActual, 0);
      const totalMonthlyRentPotential = objects.reduce((sum, obj) => sum + obj.monthlyRentPotential, 0);
      const totalVacancyArea = objects.reduce((sum, obj) => sum + obj.vacancyArea, 0);
      const totalArea = objects.reduce((sum, obj) => sum + obj.totalArea, 0);
      const avgRoi = objects.reduce((sum, obj) => sum + obj.roi, 0) / objectCount;
      const totalEquity = objects.reduce((sum, obj) => sum + obj.equity, 0);
      const totalCFYear = objects.reduce((sum, obj) => sum + obj.cashflowYear, 0);
      const totalRentYear = objects.reduce((sum, obj) => sum + obj.monthlyRentActual * 12, 0);

      document.getElementById("portfolio-object-count-tag").textContent =
        objectCount + " Objekte im Portfolio";

      document.getElementById("kpi-monthly-cf").textContent =
        formatEuro(Math.round(totalMonthlyCF));
      document.getElementById("kpi-monthly-cf-sub").textContent =
        "Jahres-CF: " + formatEuro(totalCFYear);

      document.getElementById("kpi-rent-total").textContent =
        formatEuro(totalMonthlyRent);
      document.getElementById("kpi-rent-total-sub").textContent =
        "p.a.: " + formatEuro(totalRentYear);

      document.getElementById("kpi-vacancy").textContent =
        formatArea(totalVacancyArea);
      const occupancyArea = Math.max(totalArea - totalVacancyArea, 0);
      const occupancyPct = totalArea > 0 ? (occupancyArea / totalArea) * 100 : 0;
      document.getElementById("kpi-vacancy-sub").textContent =
        "Belegung: " + formatPercent(occupancyPct);

      document.getElementById("kpi-avg-roi").textContent =
        formatPercent(avgRoi);
      document.getElementById("kpi-equity-total").textContent =
        "EK gesamt: " + formatEuro(totalEquity);

      // Home-KPIs bef√ºllen
      document.getElementById("home-kpi-cf").textContent = formatEuro(Math.round(totalMonthlyCF));
      document.getElementById("home-kpi-rent").textContent = formatEuro(totalMonthlyRent);
      document.getElementById("home-kpi-vacancy").textContent = formatArea(totalVacancyArea);
      document.getElementById("home-kpi-roi").textContent = formatPercent((totalCFYear / totalEquity) * 100);

      const tbody = document.getElementById("portfolio-objects-tbody");
      tbody.innerHTML = "";

      objects.forEach(obj => {
        const tr = document.createElement("tr");
        tr.style.cursor = "pointer";
        tr.innerHTML = `
          <td>${obj.name}</td>
          <td>${obj.city}</td>
          <td>${formatEuro(obj.monthlyRentActual)}</td>
          <td>${obj.vacancyUnits} Einh. / ${formatArea(obj.vacancyArea)}</td>
          <td>${formatPercent(obj.roi)}</td>
          <td>${formatArea(obj.totalArea)}</td>
        `;
        tr.addEventListener("click", () => {
          activateView("view-objects");
          const select = document.getElementById("object-select");
          if (select) {
            select.value = obj.id;
            updateObjectDetail(obj.id);
          }
        });
        tbody.appendChild(tr);
      });

      initPortfolioCharts(objects, totalCFYear, totalArea, totalVacancyArea);
    }

    // ===== Portfolio-Charts (inkl. Prognose) =====
    function initPortfolioCharts(objects, totalCFYear, totalArea, totalVacancyArea) {
      const ctxCF = document.getElementById("chart-cashflow").getContext("2d");
      const ctxRent = document.getElementById("chart-rent-per-object").getContext("2d");
      const ctxROI = document.getElementById("chart-roi-per-object").getContext("2d");
      const ctxVacancy = document.getElementById("chart-vacancy").getContext("2d");

      const monthsHist = ["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];
      const monthsForecast = ["+1","+2","+3","+4","+5","+6"];
      const avgMonthlyCF = totalCFYear / 12;

      const cfHistData = monthsHist.map((_, idx) => {
        const factor = 1 + (Math.sin(idx / 2) * 0.15);
        return Math.round(avgMonthlyCF * factor);
      });
      const lastHist = cfHistData[cfHistData.length - 1];
      const cfForecastData = monthsForecast.map((_, idx) => {
        const growth = 1 + 0.01 * (idx + 1);
        return Math.round(lastHist * growth);
      });

      cashflowChart = new Chart(ctxCF, {
        type: "line",
        data: {
          labels: [...monthsHist, ...monthsForecast],
          datasets: [
            {
              label: "Historie",
              data: [...cfHistData, ...Array(monthsForecast.length).fill(null)],
              tension: 0.35,
              borderWidth: 2,
              fill: true,
              borderColor: "#0ea568",
              backgroundColor: "rgba(14,165,104,0.15)"
            },
            {
              label: "Prognose",
              data: [...Array(monthsHist.length).fill(null), ...cfForecastData],
              tension: 0.35,
              borderWidth: 2,
              borderDash: [5, 4],
              fill: false,
              borderColor: "#f97316"
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            x: {
              ticks: { color: "#a3a6b7", font: { size: 10 } },
              grid: { color: "rgba(255,255,255,0.05)" }
            },
            y: {
              ticks: {
                color: "#a3a6b7",
                font: { size: 10 },
                callback: (v) => v.toLocaleString("de-DE")
              },
              grid: { color: "rgba(255,255,255,0.05)" }
            }
          }
        }
      });

      const labelsObjects = objects.map(o => o.name);
      const rentData = objects.map(o => o.monthlyRentActual);

      rentPerObjectChart = new Chart(ctxRent, {
        type: "bar",
        data: {
          labels: labelsObjects,
          datasets: [{
            label: "Miete (p.m.)",
            data: rentData,
            borderWidth: 1,
            backgroundColor: ["#0ea568","#1d8bff","#ffb020"]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            x: {
              ticks: { color: "#a3a6b7", font: { size: 10 } },
              grid: { display: false }
            },
            y: {
              ticks: {
                color: "#a3a6b7",
                font: { size: 10 },
                callback: (v) => v.toLocaleString("de-DE")
              },
              grid: { color: "rgba(255,255,255,0.05)" }
            }
          }
        }
      });

      const roiData = objects.map(o => o.roi);

      roiPerObjectChart = new Chart(ctxROI, {
        type: "bar",
        data: {
          labels: labelsObjects,
          datasets: [{
            label: "ROI",
            data: roiData,
            borderWidth: 1,
            backgroundColor: ["#22c55e","#3b82f6","#a855f7"]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            x: {
              ticks: { color: "#a3a6b7", font: { size: 10 } },
              grid: { display: false }
            },
            y: {
              ticks: {
                color: "#a3a6b7",
                font: { size: 10 },
                callback: (v) => v + " %"
              },
              grid: { color: "rgba(255,255,255,0.05)" }
            }
          }
        }
      });

      const occupancyArea = Math.max(totalArea - totalVacancyArea, 0);

      vacancyChart = new Chart(ctxVacancy, {
        type: "doughnut",
        data: {
          labels: ["Belegt", "Leerstand"],
          datasets: [{
            data: [occupancyArea, totalVacancyArea],
            borderWidth: 1,
            backgroundColor: ["#22c55e","#94a3b8"]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: "bottom",
              labels: { color: "#a3a6b7", font: { size: 10 } }
            }
          },
          cutout: "60%"
        }
      });

      updateChartTheme(localStorage.getItem("bi_dashboard_theme") || "dark");
    }

    // ===== Objekte & Mieter View =====
    function initObjectsView() {
      const select = document.getElementById("object-select");
      const objects = DATA.objects;

      select.innerHTML = "";
      objects.forEach(obj => {
        const opt = document.createElement("option");
        opt.value = obj.id;
        opt.textContent = obj.name;
        select.appendChild(opt);
      });

      select.addEventListener("change", () => {
        updateObjectDetail(select.value);
      });

      if (objects.length > 0) {
        select.value = objects[0].id;
        updateObjectDetail(objects[0].id);
      }
    }

    function updateObjectDetail(objectId) {
      const obj = DATA.objects.find(o => o.id === objectId);
      if (!obj) return;

      const metaPill = document.getElementById("object-meta-pill");
      const summary = document.getElementById("object-summary");
      const unitsTbody = document.getElementById("units-tbody");

      metaPill.textContent =
        `${obj.city} ‚Ä¢ ${formatArea(obj.totalArea)} ‚Ä¢ ROI ${formatPercent(obj.roi)}`;

      const vacancyText = obj.vacancyUnits > 0
        ? `${obj.vacancyUnits} Einheit(en) leer (${formatArea(obj.vacancyArea)})`
        : "voll vermietet";

      summary.innerHTML = `
        <strong>${obj.name}</strong> in ${obj.city}<br>
        Miete (Ist): <strong>${formatEuro(obj.monthlyRentActual)} p.m.</strong> &nbsp;‚Ä¢&nbsp;
        Potenzial: <strong>${formatEuro(obj.monthlyRentPotential)} p.m.</strong><br>
        Leerstand: <strong>${vacancyText}</strong><br>
        Jahres-Cashflow (Dummy): <strong>${formatEuro(obj.cashflowYear)}</strong> &nbsp;‚Ä¢&nbsp;
        EK-Einsatz (Dummy): <strong>${formatEuro(obj.equity)}</strong>
      `;

      unitsTbody.innerHTML = "";
      obj.units.forEach(unit => {
        const tr = document.createElement("tr");

        const statusClass =
          unit.status === "vermietet" ? "ok" :
          unit.status === "leer" ? "leer" : "";

        let paymentBadge = "";
        if (unit.paymentStatus === "p√ºnktlich") {
          paymentBadge = `<span class="badge-status ok">p√ºnktlich</span>`;
        } else if (unit.paymentStatus === "R√ºckstand") {
          paymentBadge = `<span class="badge-status risky">R√ºckstand</span>`;
        }

        tr.innerHTML = `
          <td>${unit.name}</td>
          <td>${unit.floor}</td>
          <td>${formatArea(unit.area)}</td>
          <td>${unit.status
            ? `<span class="badge-status ${statusClass}">${unit.status}</span>`
            : ""}</td>
          <td>${unit.tenant || "‚Äì"}</td>
          <td>${formatEuro(unit.rent)}</td>
          <td>${formatEuro(unit.nk)}</td>
          <td>${paymentBadge || "‚Äì"}</td>
        `;
        unitsTbody.appendChild(tr);
      });

      updateObjectCharts(obj);
    }

    function updateObjectCharts(obj) {
      const ctxRent = document.getElementById("chart-object-rent").getContext("2d");
      const ctxOcc = document.getElementById("chart-object-occupancy").getContext("2d");

      const ist = obj.monthlyRentActual;
      const soll = obj.monthlyRentPotential;
      const forecast = Math.round(soll * 1.03); // kleines Plus als Prognose

      if (objectRentChart) objectRentChart.destroy();
      objectRentChart = new Chart(ctxRent, {
        type: "bar",
        data: {
          labels: ["Ist", "Potenzial", "Prognose"],
          datasets: [{
            data: [ist, soll, forecast],
            borderWidth: 1,
            backgroundColor: ["#0ea568","#1d8bff","#f97316"]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            x: {
              ticks: { color: "#a3a6b7", font: { size: 10 } },
              grid: { display: false }
            },
            y: {
              ticks: {
                color: "#a3a6b7",
                font: { size: 10 },
                callback: v => v.toLocaleString("de-DE")
              },
              grid: { color: "rgba(255,255,255,0.05)" }
            }
          }
        }
      });

      const occArea = Math.max(obj.totalArea - obj.vacancyArea, 0);

      if (objectOccupancyChart) objectOccupancyChart.destroy();
      objectOccupancyChart = new Chart(ctxOcc, {
        type: "doughnut",
        data: {
          labels: ["vermietet", "leer"],
          datasets: [{
            data: [occArea, obj.vacancyArea],
            borderWidth: 1,
            backgroundColor: ["#22c55e","#94a3b8"]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: "bottom",
              labels: { color: "#a3a6b7", font: { size: 10 } }
            }
          },
          cutout: "60%"
        }
      });

      updateChartTheme(localStorage.getItem("bi_dashboard_theme") || "dark");
    }

    // ===== Projekte / Bau View =====
    function initProjectsView() {
      const tbody = document.getElementById("projects-tbody");
      tbody.innerHTML = "";

      DATA.objects.forEach(obj => {
        (obj.projects || []).forEach(p => {
          let statusClass = "ok";
          if (p.status === "kritisch") statusClass = "risky";
          if (p.status === "abgeschlossen") statusClass = "ok";

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${p.name}</td>
            <td>${obj.name}</td>
            <td><span class="badge-status ${statusClass}">${p.status}</span></td>
            <td>${formatEuro(p.budget)}</td>
            <td>${formatEuro(p.spent)}</td>
            <td>${formatDeviation(p.deviationPercent)}</td>
          `;
          tbody.appendChild(tr);
        });
      });
    }

    // ===== Finanzen View =====
    function initFinanceView() {
      const summaryEl = document.getElementById("finance-summary");
      const objects = DATA.objects;

      const totalCFYear = objects.reduce((sum, obj) => sum + obj.cashflowYear, 0);
      const totalEquity = objects.reduce((sum, obj) => sum + obj.equity, 0);
      const totalRentYear = objects.reduce((sum, obj) => sum + obj.monthlyRentActual * 12, 0);

      const roiPortfolio = (totalCFYear / totalEquity) * 100;

      summaryEl.innerHTML = `
        Basierend auf den Dummy-Daten:<br>
        ‚Ä¢ Jahres-Mieteinnahmen (Ist): <strong>${formatEuro(totalRentYear)}</strong><br>
        ‚Ä¢ Jahres-Cashflow (netto, Dummy): <strong>${formatEuro(totalCFYear)}</strong><br>
        ‚Ä¢ Eingesetztes Eigenkapital: <strong>${formatEuro(totalEquity)}</strong><br>
        ‚Ä¢ Portfolio-ROI (Cash-on-Cash, Dummy): <strong>${formatPercent(roiPortfolio)}</strong>
      `;
    }

    // ===== Home: Wetter, Kalender, News =====
    function loadWeather() {
      const tag = document.getElementById("weather-location-tag");
      const container = document.getElementById("weather-content");
      const url = "https://api.open-meteo.com/v1/forecast?latitude=53.03&longitude=8.54&current_weather=true&timezone=auto";

      fetch(url)
        .then(res => res.json())
        .then(data => {
          const cw = data.current_weather;
          if (!cw) throw new Error("no current weather");
          tag.textContent = `Region Ganderkesee (${cw.temperature}¬∞C)`;

          container.innerHTML = `
            <div class="weather-main">${cw.temperature.toFixed(1)}¬∞C</div>
            <div class="weather-sub">Wind: ${cw.windspeed.toFixed(0)} km/h ‚Ä¢ Richtung: ${cw.winddirection}¬∞</div>
            <div class="summary-block" style="margin-top:8px;">
              Code: ${cw.weathercode} ‚Ä¢ Zeit: ${new Date(cw.time).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})}
            </div>
          `;
        })
        .catch(() => {
          tag.textContent = "Region Ganderkesee";
          container.innerHTML = `
            <div class="weather-main">‚Äì¬∞C</div>
            <div class="weather-sub">Wetterdaten aktuell nicht abrufbar.</div>
          `;
        });
    }

    function buildCalendar() {
      const headerEl = document.getElementById("calendar-header");
      const gridEl = document.getElementById("calendar-grid");

      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth();

      const monthName = today.toLocaleString("de-DE", { month: "long" });
      headerEl.textContent = `${monthName} ${year}`;

      gridEl.innerHTML = "";
      const weekdays = ["Mo","Di","Mi","Do","Fr","Sa","So"];
      weekdays.forEach(d => {
        const cell = document.createElement("div");
        cell.className = "calendar-cell head";
        cell.textContent = d;
        gridEl.appendChild(cell);
      });

      const firstDay = new Date(year, month, 1);
      const startWeekday = (firstDay.getDay() + 6) % 7;
      for (let i = 0; i < startWeekday; i++) {
        const empty = document.createElement("div");
        empty.className = "calendar-cell";
        gridEl.appendChild(empty);
      }

      const daysInMonth = new Date(year, month + 1, 0).getDate();
      for (let d = 1; d <= daysInMonth; d++) {
        const cell = document.createElement("div");
        cell.className = "calendar-cell";
        cell.textContent = d;
        if (d === today.getDate()) {
          cell.classList.add("today");
        }
        gridEl.appendChild(cell);
      }
    }

    function loadNews() {
      const statusEl = document.getElementById("news-status");
      const listEl = document.getElementById("news-list");

      const fallbackNews = [
        {
          title: "Dummy: Mietpreisentwicklungen im Nordwesten",
          link: "https://www.immobilien-zeitung.de/"
        },
        {
          title: "Dummy: F√∂rderprogramme f√ºr energetische Sanierungen",
          link: "https://www.kfw.de/"
        },
        {
          title: "Dummy: Entwicklung Baukostenindex Deutschland",
          link: "https://www.destatis.de/"
        }
      ];

      function renderNews(items) {
        listEl.innerHTML = "";
        items.forEach(n => {
          const li = document.createElement("li");
          li.innerHTML = `<a href="${n.link}" target="_blank" rel="noopener">${n.title}</a>`;
          listEl.appendChild(li);
        });
      }

      const rssProxy = "https://api.allorigins.win/get?url=" +
        encodeURIComponent("https://www.immobilien-zeitung.de/rss");

      fetch(rssProxy)
        .then(res => res.json())
        .then(data => {
          if (!data || !data.contents) throw new Error("no rss contents");
          const parser = new DOMParser();
          const xml = parser.parseFromString(data.contents, "text/xml");
          const items = Array.from(xml.querySelectorAll("item")).slice(0, 5);
          const news = items.map(it => ({
            title: it.querySelector("title")?.textContent || "News",
            link: it.querySelector("link")?.textContent || "#"
          }));
          if (!news.length) throw new Error("no items");
          statusEl.textContent = "Live";
          renderNews(news);
        })
        .catch(() => {
          statusEl.textContent = "Fallback";
          renderNews(fallbackNews);
        });
    }

    // ===== Charts Theme Update =====
    function updateChartTheme(theme) {
      const isDark = theme !== "light";
      const axisColor = isDark ? "#a3a6b7" : "#4b5563";
      const gridColor = isDark ? "rgba(148,163,184,0.3)" : "rgba(209,213,219,0.7)";
      const legendColor = axisColor;

      const charts = [
        cashflowChart,
        rentPerObjectChart,
        roiPerObjectChart,
        vacancyChart,
        objectRentChart,
        objectOccupancyChart
      ];

      charts.forEach(ch => {
        if (!ch) return;
        if (ch.options.scales) {
          if (ch.options.scales.x) {
            ch.options.scales.x.ticks.color = axisColor;
            if (ch.options.scales.x.grid) ch.options.scales.x.grid.color = gridColor;
          }
          if (ch.options.scales.y) {
            ch.options.scales.y.ticks.color = axisColor;
            if (ch.options.scales.y.grid) ch.options.scales.y.grid.color = gridColor;
          }
        }
        if (ch.options.plugins && ch.options.plugins.legend && ch.options.plugins.legend.labels) {
          ch.options.plugins.legend.labels.color = legendColor;
        }
        ch.update();
      });
    }

    // ===== Theme-Buttons =====
    const btnThemeDark = document.getElementById("btn-theme-dark");
    const btnThemeLight = document.getElementById("btn-theme-light");
    const themePill = document.getElementById("theme-pill");

    if (btnThemeDark) {
      btnThemeDark.addEventListener("click", () => applyTheme("dark"));
    }
    if (btnThemeLight) {
      btnThemeLight.addEventListener("click", () => applyTheme("light"));
    }
    if (themePill) {
      themePill.addEventListener("click", () => {
        const current = document.documentElement.getAttribute("data-theme") || "dark";
        applyTheme(current === "dark" ? "light" : "dark");
      });
    }

    // ===== Initialisierung nach Laden =====
    window.addEventListener("load", () => {
      initTheme();
      initPortfolioView();
      initObjectsView();
      initProjectsView();
      initFinanceView();
      loadWeather();
      buildCalendar();
      loadNews();
      activateView("view-home");
    });
  </script>
</body>
</html>