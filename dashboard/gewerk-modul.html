<!-- =========================================
  GEWERK – EINZELMODUL
  Erwartet:
  root.dataset.payload = JSON.stringify({
    projekt,
    gewerk,
    angebot,
    zahlungen,
    offeneRechnungen,
    fortschritt,
    owner,
    lastUpdate
  })
========================================= -->

<div class="gewerk-modul-root"></div>

<style>
  .gewerk-modul-root{
    border-radius:16px;
    border:1px solid rgba(148,163,184,.35);
    background:
      radial-gradient(circle at top, rgba(148,163,184,.14), rgba(15,23,42,.92));
    position:relative;
    overflow:hidden;
  }

  .gewerk-modul-root::before{
    content:"";
    position:absolute; inset:0;
    background:
      radial-gradient(circle at 20% 0%, rgba(59,130,246,.12), transparent 40%),
      radial-gradient(circle at 80% 10%, rgba(249,115,22,.10), transparent 45%);
    pointer-events:none;
  }

  /* Header */
  .gm-head{
    padding:12px 14px 10px;
    border-bottom:1px solid rgba(148,163,184,.18);
    display:flex;
    justify-content:space-between;
    gap:10px;
    position:relative;
  }

  .gm-title{
    margin:0;
    font-size:14px;
    font-weight:900;
    color:#e2e8f0;
    line-height:1.2;
  }

  .gm-sub{
    margin-top:4px;
    font-size:11px;
    color:rgba(226,232,240,.7);
  }

  .gm-status{
    font-size:10px;
    padding:2px 10px;
    border-radius:999px;
    border:1px solid rgba(148,163,184,.45);
    background:rgba(2,6,23,.25);
    height:fit-content;
    white-space:nowrap;
  }

  .gm-status.ok{
    border-color:rgba(34,197,94,.55);
    color:rgba(187,247,208,.95);
  }

  .gm-status.warn{
    border-color:rgba(248,113,113,.65);
    color:rgba(254,202,202,.95);
  }

  /* Body */
  .gm-body{
    padding:10px 14px 14px;
    display:flex;
    flex-direction:column;
    gap:10px;
    position:relative;
  }

  /* KPI Row */
  .gm-kpis{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:8px;
  }

  .gm-kpi{
    border-radius:12px;
    border:1px solid rgba(148,163,184,.2);
    background:rgba(15,23,42,.7);
    padding:8px 8px 7px;
  }

  .gm-kpi .l{
    font-size:10px;
    text-transform:uppercase;
    letter-spacing:.05em;
    color:rgba(226,232,240,.65);
  }

  .gm-kpi .v{
    margin-top:4px;
    font-size:14px;
    font-weight:900;
    color:#e2e8f0;
  }

  /* Bars */
  .gm-rowtitle{
    display:flex;
    justify-content:space-between;
    font-size:11px;
    font-weight:700;
    color:rgba(226,232,240,.8);
    margin-bottom:4px;
  }

  .gm-barrow{
    display:grid;
    grid-template-columns:auto 1fr auto;
    gap:6px;
    align-items:center;
    font-size:10px;
    color:rgba(226,232,240,.6);
  }

  .gm-track{
    height:14px;
    border-radius:999px;
    background:rgba(2,6,23,.55);
    border:1px solid rgba(148,163,184,.16);
    overflow:hidden;
    position:relative;
  }

  .gm-fill{
    position:absolute;
    inset:0 auto 0 0;
    width:0%;
    border-radius:999px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:9px;
    font-weight:800;
    color:#fff;
    transition:width .9s cubic-bezier(.16,1,.3,1);
    white-space:nowrap;
  }

  .blue{ background:linear-gradient(90deg,#2563eb,#3b82f6); }
  .green{ background:linear-gradient(90deg,#22c55e,#4ade80); }

  .gm-meta{
    margin-top:4px;
    font-size:10px;
    color:rgba(226,232,240,.65);
    line-height:1.3;
  }

  /* Warn Pulse */
  @keyframes warnPulse{
    0%{ box-shadow:0 0 0 0 rgba(248,113,113,.6); }
    60%{ box-shadow:0 0 0 8px rgba(248,113,113,0); }
    100%{ box-shadow:0 0 0 0 rgba(248,113,113,0); }
  }

  .gewerk-modul-root.warn{
    border-color:rgba(248,113,113,.65);
    animation:warnPulse 1.6s ease-out infinite;
  }
</style>

<script>
(function(){
  const root = document.currentScript.previousElementSibling;
  if(!root) return;

  const d = JSON.parse(root.dataset.payload || "{}");

  const angebot = Number(d.angebot || 0);
  const zahlungen = Number(d.zahlungen || 0);
  const fortschritt = Number(d.fortschritt || 0);
  const offen = Number(d.offeneRechnungen || 0);

  const kostenQuote = angebot > 0 ? zahlungen / angebot * 100 : 0;
  const rest = angebot - zahlungen;
  const warn = angebot > 0 && kostenQuote > (fortschritt + 8);

  root.classList.toggle("warn", warn);

  root.innerHTML = `
    <div class="gm-head">
      <div>
        <h3 class="gm-title">${d.gewerk || "Gewerk"}</h3>
        <div class="gm-sub">${d.projekt || ""}</div>
      </div>
      <div class="gm-status ${warn ? "warn" : "ok"}">
        ${warn ? "Kosten > Fortschritt" : "OK"}
      </div>
    </div>

    <div class="gm-body">
      <div class="gm-kpis">
        <div class="gm-kpi">
          <div class="l">Angebot</div>
          <div class="v">${angebot.toLocaleString("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:0})}</div>
        </div>
        <div class="gm-kpi">
          <div class="l">Zahlungen</div>
          <div class="v">${zahlungen.toLocaleString("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:0})}</div>
        </div>
        <div class="gm-kpi">
          <div class="l">Rest</div>
          <div class="v">${rest.toLocaleString("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:0})}</div>
        </div>
      </div>

      <div>
        <div class="gm-rowtitle">
          <span>Zahlungen / Budget</span>
          <span>${kostenQuote.toFixed(1)} %</span>
        </div>
        <div class="gm-barrow">
          <span>0%</span>
          <div class="gm-track">
            <div class="gm-fill blue" style="width:${Math.min(kostenQuote,100)}%">
              ${kostenQuote.toFixed(1)} %
            </div>
          </div>
          <span>100%</span>
        </div>
      </div>

      <div>
        <div class="gm-rowtitle">
          <span>Baufortschritt</span>
          <span>${fortschritt.toFixed(1)} %</span>
        </div>
        <div class="gm-barrow">
          <span>0%</span>
          <div class="gm-track">
            <div class="gm-fill green" style="width:${Math.min(fortschritt,100)}%">
              ${fortschritt.toFixed(1)} %
            </div>
          </div>
          <span>100%</span>
        </div>
      </div>

      <div class="gm-meta">
        Offene Rechnungen: <strong>${offen.toLocaleString("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:0})}</strong>
        ${d.owner ? " · Owner: " + d.owner : ""}
      </div>
    </div>
  `;
})();
</script>