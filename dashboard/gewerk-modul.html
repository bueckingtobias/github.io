<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gewerk-Modul – Test</title>
  <style>
    :root{
      --bg:#0b1220;
      --card: rgba(15,23,42,.88);
      --card2: rgba(15,23,42,.70);
      --stroke: rgba(148,163,184,.35);
      --soft: rgba(226,232,240,.70);
      --text: rgba(226,232,240,.92);
      --good: rgba(34,197,94,.95);
      --warn: rgba(248,113,113,.95);
      --blue1:#2563eb;
      --blue2:#3b82f6;
      --orange1:#f97316;
      --orange2:#fb923c;
      --green1:#22c55e;
      --green2:#4ade80;

      --r: 16px;
    }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(circle at 20% 0%, rgba(59,130,246,.18), transparent 35%),
                  radial-gradient(circle at 80% 0%, rgba(34,197,94,.14), transparent 35%),
                  var(--bg);
      color: var(--text);
      padding: 18px;
    }
    .wrap{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      max-width: 1100px;
      margin: 0 auto;
    }

    /* ===== Gewerk-Modul (reusable) ===== */
    .gewerk-mod{
      border-radius: var(--r);
      border: 1px solid var(--stroke);
      background: radial-gradient(circle at top, rgba(148,163,184,.16), rgba(15,23,42,.92));
      overflow:hidden;
      position:relative;
    }
    .gewerk-mod::before{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(circle at 20% 0%, rgba(59,130,246,.12), transparent 35%),
                  radial-gradient(circle at 70% 0%, rgba(249,115,22,.10), transparent 40%);
      pointer-events:none;
    }
    .gewerk-head{
      position:relative;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap: 12px;
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(148,163,184,.18);
    }
    .gewerk-title{
      font-size: 14px;
      font-weight: 700;
      letter-spacing: .2px;
      margin: 0;
      line-height: 1.15;
    }
    .gewerk-sub{
      margin-top: 4px;
      font-size: 12px;
      color: var(--soft);
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
    }
    .pill{
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.45);
      color: var(--soft);
      white-space:nowrap;
      background: rgba(15,23,42,.45);
      backdrop-filter: blur(6px);
    }
    .pill.good{ border-color: rgba(34,197,94,.55); color: rgba(187,247,208,.95); }
    .pill.warn{ border-color: rgba(248,113,113,.65); color: rgba(254,202,202,.95); }

    .gewerk-body{
      position:relative;
      padding: 12px 14px 14px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    /* KPI row */
    .kpis{
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 10px;
    }
    @media (max-width: 900px){
      .kpis{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    }
    .kpi{
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,.20);
      background: rgba(15,23,42,.72);
      padding: 10px 10px 9px;
      min-height: 68px;
    }
    .kpi .label{
      font-size: 11px;
      color: var(--soft);
      text-transform: uppercase;
      letter-spacing: .05em;
    }
    .kpi .value{
      margin-top: 6px;
      font-size: 16px;
      font-weight: 800;
      letter-spacing: .2px;
    }
    .kpi .hint{
      margin-top: 4px;
      font-size: 11px;
      color: var(--soft);
    }

    /* Bars */
    .bars{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 10px;
    }
    @media (max-width: 900px){
      .bars{ grid-template-columns: 1fr; }
    }
    .panel{
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,.20);
      background: rgba(15,23,42,.62);
      padding: 10px;
    }
    .rowtitle{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap: 10px;
      margin-bottom: 8px;
    }
    .rowtitle .t{
      font-size: 12px;
      font-weight: 700;
    }
    .rowtitle .s{
      font-size: 11px;
      color: var(--soft);
      white-space:nowrap;
    }

    .barrow{
      display:grid;
      grid-template-columns: auto minmax(0,1fr) auto;
      gap: 8px;
      align-items:center;
      font-size: 11px;
      color: var(--soft);
    }
    .track{
      position:relative;
      height: 16px;
      border-radius: 999px;
      background: rgba(2,6,23,.55);
      overflow:hidden;
      border: 1px solid rgba(148,163,184,.16);
    }
    .fill{
      position:absolute; inset:0 auto 0 0;
      width: 0%;
      border-radius: 999px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 0 8px;
      font-size: 10px;
      font-weight: 700;
      color:#fff;
      white-space:nowrap;
      transition: width .9s cubic-bezier(.16,1,.3,1);
    }
    .fill.orange{ background: linear-gradient(90deg,var(--orange1),var(--orange2)); }
    .fill.green{  background: linear-gradient(90deg,var(--green1),var(--green2)); }
    .fill.blue{   background: linear-gradient(90deg,var(--blue1),var(--blue2)); }

    .meta{
      margin-top: 8px;
      font-size: 11px;
      color: var(--soft);
      line-height: 1.25;
    }

    /* Warn outline + pulse */
    @keyframes warnPulse {
      0%   { box-shadow: 0 0 0 0 rgba(248,113,113,.65); }
      60%  { box-shadow: 0 0 0 10px rgba(248,113,113,0); }
      100% { box-shadow: 0 0 0 0 rgba(248,113,113,0); }
    }
    .gewerk-mod.is-warn{
      border-color: rgba(248,113,113,.65);
      animation: warnPulse 1.6s ease-out infinite;
    }
    .gewerk-mod.is-ok{
      border-color: rgba(34,197,94,.50);
      box-shadow: 0 0 0 1px rgba(34,197,94,.25);
    }

    /* Tiny delta badge */
    .delta{
      display:flex; align-items:center; gap:8px;
      margin-top: 8px;
    }
    .delta .badge{
      font-size:10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.35);
      background: rgba(2,6,23,.35);
      color: var(--soft);
      white-space:nowrap;
    }
    .delta .badge.warn{ border-color: rgba(248,113,113,.6); color: rgba(254,202,202,.95); }
    .delta .badge.good{ border-color: rgba(34,197,94,.55); color: rgba(187,247,208,.95); }
    .delta .txt{
      font-size:11px; color: var(--soft);
    }
  </style>
</head>

<body>
  <div class="wrap" id="modules"></div>

  <script>
    // ===== Reusable Gewerk-Modul =====
    (function(){
      function euro(n){
        n = Number(n)||0;
        return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(n);
      }
      function pct(n){
        n = Number(n)||0;
        return (Math.round(n*10)/10).toFixed(1).replace(".",",") + " %";
      }
      function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

      /**
       * Render a single Gewerk module into a container.
       * @param {HTMLElement} mount
       * @param {Object} d
       * d = {
       *  projekt, objekt, gewerk,
       *  angebot, zahlungen, fortschritt,  // fortschritt in % (0..100)
       *  offeneRechnungen, lastUpdate, owner
       * }
       */
      window.renderGewerkModule = function(mount, d){
        const angebot = Number(d.angebot)||0;
        const zahlungen = Number(d.zahlungen)||0;
        const fortschritt = clamp(Number(d.fortschritt)||0, 0, 100);

        const kostenQuote = angebot > 0 ? (zahlungen/angebot*100) : 0;               // % Budget verbraucht
        const rest = angebot - zahlungen;                                           // € verbleibend (negativ = drüber)
        const deltaPunkte = kostenQuote - fortschritt;                              // %-Punkte Kosten vs Fortschritt

        // simple Forecast: wenn Fortschritt > 0: EAC = zahlungen / (fortschritt/100)
        const eac = fortschritt > 0 ? (zahlungen / (fortschritt/100)) : 0;
        const eacDelta = eac - angebot;

        const isWarn = deltaPunkte > 8; // Schwelle: >8 %-Punkte "Kosten > Fortschritt"
        const statusPill = isWarn ? "Kosten > Fortschritt" : "OK";

        const mod = document.createElement("section");
        mod.className = "gewerk-mod " + (isWarn ? "is-warn" : "is-ok");

        mod.innerHTML = `
          <div class="gewerk-head">
            <div>
              <h3 class="gewerk-title">${(d.gewerk||"Gewerk").toString()}</h3>
              <div class="gewerk-sub">
                ${d.projekt ? `<span class="pill">${d.projekt}</span>` : ""}
                ${d.objekt ? `<span class="pill">${d.objekt}</span>` : ""}
                ${d.owner ? `<span class="pill">Owner: ${d.owner}</span>` : ""}
                ${d.lastUpdate ? `<span class="pill">Update: ${d.lastUpdate}</span>` : ""}
              </div>
            </div>
            <div class="pill ${isWarn ? "warn" : "good"}">${statusPill}</div>
          </div>

          <div class="gewerk-body">
            <div class="kpis">
              <div class="kpi">
                <div class="label">Angebot / Budget</div>
                <div class="value">${euro(angebot)}</div>
                <div class="hint">Basis für Kostenquote & Forecast</div>
              </div>
              <div class="kpi">
                <div class="label">Zahlungen</div>
                <div class="value">${euro(zahlungen)}</div>
                <div class="hint">${pct(kostenQuote)} vom Budget</div>
              </div>
              <div class="kpi">
                <div class="label">Restbudget</div>
                <div class="value">${euro(rest)}</div>
                <div class="hint">${rest < 0 ? "Über Budget" : "Verfügbar"}</div>
              </div>
              <div class="kpi">
                <div class="label">Fortschritt</div>
                <div class="value">${pct(fortschritt)}</div>
                <div class="hint">${isWarn ? "Prüfen: Abrechnung vs. Leistung" : "Im Rahmen"}</div>
              </div>
            </div>

            <div class="bars">
              <div class="panel">
                <div class="rowtitle">
                  <div class="t">Kostenquote (Zahlungen vs. Budget)</div>
                  <div class="s">${euro(zahlungen)} / ${euro(angebot)}</div>
                </div>
                <div class="barrow">
                  <span>0%</span>
                  <div class="track">
                    <div class="fill orange" data-width="${clamp(kostenQuote,0,100)}%">
                      ${pct(clamp(kostenQuote,0,100))}
                    </div>
                  </div>
                  <span>100%</span>
                </div>
                <div class="meta">
                  ${d.offeneRechnungen ? `Offene Rechnungen: <strong>${euro(d.offeneRechnungen)}</strong><br/>` : ""}
                  Forecast (EAC): <strong>${euro(eac)}</strong>
                  ${angebot>0 ? ` · Abweichung: <strong>${euro(eacDelta)}</strong>` : ""}
                </div>
              </div>

              <div class="panel">
                <div class="rowtitle">
                  <div class="t">Baufortschritt</div>
                  <div class="s">Soll: 100%</div>
                </div>
                <div class="barrow">
                  <span>0%</span>
                  <div class="track">
                    <div class="fill green" data-width="${fortschritt}%">
                      ${pct(fortschritt)}
                    </div>
                  </div>
                  <span>100%</span>
                </div>

                <div class="delta">
                  <div class="badge ${isWarn ? "warn" : "good"}">
                    Δ ${pct(deltaPunkte)} (Kosten - Fortschritt)
                  </div>
                  <div class="txt">
                    ${isWarn
                      ? "Kosten laufen dem Fortschritt voraus – Freigaben/Leistungsstand prüfen."
                      : "Kosten & Fortschritt sind plausibel zueinander."
                    }
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;

        mount.appendChild(mod);

        // animate fills
        requestAnimationFrame(() => {
          mod.querySelectorAll(".fill").forEach(el=>{
            const w = el.getAttribute("data-width");
            el.style.width = w || "0%";
          });
        });
      };
    })();

    // ===== TEST: render 3 Gewerke (du wirst später 10x rendern) =====
    const mount = document.getElementById("modules");

    const demo = [
      { projekt:"Hof Ganderkesee Umbau", objekt:"Hof Ganderkesee", gewerk:"Rohbau", angebot:320000, zahlungen:210000, fortschritt:70, offeneRechnungen:18000, lastUpdate:"12.12.2025", owner:"Tobi" },
      { projekt:"Hof Ganderkesee Umbau", objekt:"Hof Ganderkesee", gewerk:"Elektro", angebot:95000, zahlungen:65000, fortschritt:30, offeneRechnungen:9000, lastUpdate:"10.12.2025", owner:"Tobi" }, // Warn (Kosten > Fortschritt)
      { projekt:"Hof Ganderkesee Umbau", objekt:"Hof Ganderkesee", gewerk:"PV", angebot:98000, zahlungen:49000, fortschritt:45, offeneRechnungen:0, lastUpdate:"08.12.2025", owner:"Tobi" }
    ];

    demo.forEach(d => window.renderGewerkModule(mount, d));
  </script>
</body>
</html>