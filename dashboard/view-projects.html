<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Projekte / Bau</title>

  <style>
    body{
      margin:0;
      background:#0b1220;
      font-family:system-ui,-apple-system,Segoe UI,Roboto;
      color:#e2e8f0;
    }

    .view-root{
      height:100vh;
      display:flex;
      flex-direction:column;
    }

    .page-body{
      flex:1;
      overflow:auto;
      padding:16px;
      display:flex;
      justify-content:center;
    }

    .content{
      width:100%;
      max-width:1200px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .modules-grid{
      display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap:12px;
    }

    .span-2{
      grid-column:1 / -1;
    }

    @media (max-width:900px){
      .modules-grid{
        grid-template-columns:1fr;
      }
      .span-2{
        grid-column:auto;
      }
    }
  </style>
</head>

<body>
<div class="view-root">
  <div class="page-body">
    <div class="content">

      <div id="gesamt-slot" class="span-2"></div>

      <div class="modules-grid" id="gewerke-grid"></div>

    </div>
  </div>
</div>

<script>
/* =========================
   1. Excel-ähnliche Daten
   (später ersetzt durch projects.xlsx)
========================= */
const excelRows = [
  {"Sortierung":1,"Aktiv (Ja/Nein)":"Ja","Gewerk":"Rohbau","Handwerker":"Meyer","Angebotssumme (€)":320000,"Zahlungen bisher (€)":210000,"Offene Rechnungen (€)":18000,"Baufortschritt (%)":70},
  {"Sortierung":2,"Aktiv (Ja/Nein)":"Ja","Gewerk":"Elektro","Handwerker":"Schröder","Angebotssumme (€)":95000,"Zahlungen bisher (€)":65000,"Offene Rechnungen (€)":9000,"Baufortschritt (%)":30},
  {"Sortierung":3,"Aktiv (Ja/Nein)":"Ja","Gewerk":"Heizung/Sanitär","Handwerker":"Müller","Angebotssumme (€)":145000,"Zahlungen bisher (€)":60000,"Offene Rechnungen (€)":12000,"Baufortschritt (%)":40},
  {"Sortierung":4,"Aktiv (Ja/Nein)":"Ja","Gewerk":"Fenster/Türen","Handwerker":"Becker","Angebotssumme (€)":78000,"Zahlungen bisher (€)":52000,"Offene Rechnungen (€)":0,"Baufortschritt (%)":85}
];

/* global für Gesamtmodul */
window.__PROJECT_ROWS__ = excelRows;

/* =========================
   2. Helper: HTML laden
========================= */
async function loadHTML(url){
  const res = await fetch(url);
  return await res.text();
}

/* =========================
   3. Gesamtmodul laden
========================= */
(async ()=>{
  const html = await loadHTML("./gewerk-gesamt-modul.html");
  document.getElementById("gesamt-slot").innerHTML = html;
})();

/* =========================
   4. 10x Gewerkmodule laden
========================= */
(async ()=>{
  const grid = document.getElementById("gewerke-grid");
  const tpl = await loadHTML("./gewerk-modul.html");

  excelRows
    .filter(r => r["Aktiv (Ja/Nein)"] === "Ja")
    .sort((a,b)=>a.Sortierung-b.Sortierung)
    .slice(0,10)
    .forEach(row=>{
      const slot = document.createElement("div");
      slot.innerHTML = tpl;

      const payload = {
        projekt:"Baumstraße 35",
        gewerk: row.Gewerk + " – " + row.Handwerker,
        angebot: row["Angebotssumme (€)"],
        zahlungen: row["Zahlungen bisher (€)"],
        offeneRechnungen: row["Offene Rechnungen (€)"],
        fortschritt: row["Baufortschritt (%)"],
        owner:"Tobi"
      };

      slot.querySelector(".gewerk-modul-root")
        .dataset.payload = JSON.stringify(payload);

      grid.appendChild(slot);
    });
})();
</script>

</body>
</html>