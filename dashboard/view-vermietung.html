<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Vermietung Â· Dashboard</title>
  <meta name="robots" content="noindex,nofollow" />
  <meta name="theme-color" content="#0b1220" />

  <!-- âœ… Version / Cachebuster (optional, aber identisch zur Home-Architektur) -->
  <script>window.__VER="20251214-Vermietung-1";</script>

  <!-- âœ… Shell (enthÃ¤lt Sidebar/Topbar Styles wie in Home) -->
  <link rel="stylesheet" href="./shell.css?v=20251214-Vermietung-1" />

  <!-- âœ… Auth -->
  <script src="./auth.js"></script>
  <script>Auth.requireAuth({ loginUrl: "./login.html" });</script>

  <!-- Vermietung-Module -->
  <link rel="stylesheet" href="./vermietung-modul.css?v=20251214-Vermietung-1" />
</head>

<body>
<div class="app">

  <!-- âœ… 1:1 DIE LINKE SEITE AUS DEINER HOME-DATEI -->
  <aside class="sidebar">
    <div class="brand">
      <div class="brand-dot"></div>
      <div>
        <div class="brand-title">BÃ¼cking Dashboard</div>
        <div class="brand-sub">Immobilien Â· Projekte Â· KPIs</div>
      </div>
    </div>

    <nav class="nav">
      <a href="./view-home.html">
        <div class="nav-ic">âŒ‚</div>
        <div class="nav-txt">
          <div class="nav-title">Home</div>
          <div class="nav-sub">Ãœbersicht</div>
        </div>
      </a>

      <div class="nav-label">Vermietung</div>
      <a href="./view-vermietung.html" class="active">
        <div class="nav-ic">ğŸ </div>
        <div class="nav-txt">
          <div class="nav-title">Vermietung</div>
          <div class="nav-sub">Objekte Â· Anfragen</div>
        </div>
      </a>

      <div class="nav-label">Projekte</div>

      <!-- âœ… Umbenannt: Projekte / Bau -> BaumstraÃŸe (Link + Sub unverÃ¤ndert) -->
      <a href="./view-projects.html">
        <div class="nav-ic">ğŸ—</div>
        <div class="nav-txt">
          <div class="nav-title">BaumstraÃŸe</div>
          <div class="nav-sub">Gesamt + Gewerke</div>
        </div>
      </a>

      <!-- â• Platzhalter: Am HÃ¼nenberg -->
      <a href="./view-project-am-huenenberg.html">
        <div class="nav-ic">ğŸ—</div>
        <div class="nav-txt">
          <div class="nav-title">Am HÃ¼nenberg</div>
          <div class="nav-sub">Projekt (Platzhalter)</div>
        </div>
      </a>

      <div class="nav-label">Finanzen</div>
      <a href="./view-finance.html">
        <div class="nav-ic">â‚¬</div>
        <div class="nav-txt">
          <div class="nav-title">Finanzen</div>
          <div class="nav-sub">Cashflow, Budget</div>
        </div>
      </a>

      <div class="nav-label">Tools</div>
      <a href="./admin-data.html">
        <div class="nav-ic">âœ</div>
        <div class="nav-txt">
          <div class="nav-title">Admin Daten</div>
          <div class="nav-sub">Pflege Master</div>
        </div>
      </a>
    </nav>

    <div class="sidebar-footer">
      <button class="btn" id="logoutBtn">Logout</button>
    </div>
  </aside>

  <!-- âœ… Main Bereich (Content deiner Vermietung-Seite bleibt inhaltlich gleich) -->
  <section class="main">
    <header class="topbar">
      <div class="page-title">
        <h1>Vermietung</h1>
        <div>Auslastung Â· Mieten Â· Pipeline</div>
      </div>
      <div class="top-right">
        <span class="chip" id="clockTop">â€”</span>
        <span class="chip" id="dataChip">Daten: â€”</span>
      </div>
    </header>

    <main class="content">
      <div class="container" style="max-width:1400px;">
        <section class="grid">
          <section class="card" style="grid-column: span 12;">
            <div class="card-header">
              <div>
                <div class="card-title">Vermietung</div>
                <div class="card-sub">Auslastung Â· Mieten Â· Pipeline.</div>
              </div>
            </div>
            <div class="card-body">
              <div class="vermietung-root" id="vermietungRoot"></div>
            </div>
          </section>
        </section>

        <div class="debugline" id="debugLine" style="
          margin-top:10px;
          padding:10px 12px;
          border-radius:14px;
          border:1px solid rgba(148,163,184,.14);
          background: rgba(2,6,23,.22);
          color: rgba(226,232,240,.72);
          font-size: 12px;
          line-height:1.35;
          word-break: break-word;
        ">Debug: â€”</div>
      </div>
    </main>
  </section>
</div>

<!-- âœ… DataLoader (wie Home) -->
<script src="./data-loader.js?v=20251214-Vermietung-1"></script>

<!-- âœ… Vermietung-Modul JS -->
<script src="./vermietung-modul.js?v=20251214-Vermietung-1"></script>

<script>
(async function(){

  // Clock (wie Home)
  const clockTop = document.getElementById("clockTop");
  function tick(){
    const d = new Date();
    clockTop.textContent = d.toLocaleString("de-DE",{weekday:"short",hour:"2-digit",minute:"2-digit"});
  }
  tick(); setInterval(tick,15000);

  // Logout (wie Home)
  document.getElementById("logoutBtn").onclick = () => {
    try { localStorage.clear(); } catch {}
    location.href = "./index.html";
  };

  // Load master data (wie Home)
  await DataLoader.load();

  // Status Chips (wie Home)
  const chip = document.getElementById("dataChip");
  const dbg = document.getElementById("debugLine");
  const meta = window.IMMO_DATA_META || {};

  const hasMaster = !!window.IMMO_MASTER_DATA;
  const hasData = !!window.IMMO_DATA;

  if (meta.ok) {
    chip.textContent = `Master:OK Â· Loader:OK Â· v ${meta.version || "â€”"}`;
  } else {
    chip.textContent = `Master:FAIL Â· Loader:OK`;
  }

  dbg.textContent =
    `Debug: expected master url = ${meta.expectedUrl || "(unknown)"} | reason = ${meta.reason || "(none)"} | ` +
    `has IMMO_MASTER_DATA = ${hasMaster} | has IMMO_DATA = ${hasData}`;

  // Render Vermietung Modul
  const host = document.getElementById("vermietungRoot");
  if (host && window.VermietungModul?.render) {
    window.VermietungModul.render(host, {});
    setTimeout(() => window.VermietungModul?.render && window.VermietungModul.render(host, {}), 250);
  } else if (host) {
    host.innerHTML = `<div class="module-error" style="
      font-size:12px;color:rgba(226,232,240,.78);line-height:1.35;padding:12px;border-radius:14px;
      border:1px solid rgba(239,68,68,.25);background:rgba(239,68,68,.08);
    "><b>VermietungModul fehlt (JS nicht gefunden).</b></div>`;
  }

})();
</script>

</body>
</html>