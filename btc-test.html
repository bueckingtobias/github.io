<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BTC KPI Widget</title>

<style>
:root{
  --stroke: rgba(255,255,255,.14);
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.62);
  --good: #34C759;
  --bad: #FF3B30;
}
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  display:grid;
  place-items:center;
  background:
    radial-gradient(1200px 800px at 20% 10%, #1b2a55 0%, transparent 55%),
    radial-gradient(900px 700px at 80% 30%, #1f4a3c 0%, transparent 60%),
    linear-gradient(180deg,#070a10 0%,#0b0f17 100%);
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text","Segoe UI",Roboto,Helvetica,Arial;
  color:var(--text);
}
.btc{
  width:min(560px,calc(100vw - 24px));
  border:1px solid var(--stroke);
  border-radius:18px;
  background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.06));
  backdrop-filter:blur(14px);
  box-shadow:0 18px 60px rgba(0,0,0,.45);
  overflow:hidden;
}
.hdr{
  padding:14px 16px 10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.title{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:600;
}
.dot{
  width:10px;
  height:10px;
  border-radius:50%;
  background:#f2a900;
  box-shadow:0 0 0 6px rgba(242,169,0,.15);
}
.sub{font-size:12px;color:var(--muted)}
.tabs{
  display:flex;
  gap:6px;
  padding:0 10px 10px;
}
.tab{
  padding:8px 12px;
  border-radius:12px;
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.06);
  font-size:13px;
  color:var(--muted);
  cursor:pointer;
}
.tab[aria-selected="true"]{
  background:rgba(255,255,255,.14);
  color:var(--text);
}
.body{padding:16px;display:grid;gap:12px}
.kpi{
  padding:14px;
  border-radius:16px;
  background:rgba(0,0,0,.25);
  border:1px solid rgba(255,255,255,.1);
}
.kpi-top{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
}
.price{
  font-size:34px;
  font-weight:700;
}
.meta{
  display:flex;
  flex-direction:column;
  gap:8px;
  text-align:right;
  font-size:12px;
}
.row{display:flex;gap:8px;justify-content:flex-end}
.pill{
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  min-width:120px;
  text-align:right;
  font-weight:600;
}
.good{background:rgba(52,199,89,.15);border-color:rgba(52,199,89,.4)}
.bad{background:rgba(255,59,48,.15);border-color:rgba(255,59,48,.4)}
.chart{
  height:140px;
  margin-top:12px;
  border-radius:14px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.1);
  background:rgba(255,255,255,.04);
}
canvas{width:100%;height:100%}
.foot{
  padding:10px 16px;
  border-top:1px solid rgba(255,255,255,.1);
  font-size:12px;
  color:var(--muted);
  display:flex;
  justify-content:space-between;
}
</style>
</head>

<body>
<section class="btc">
  <div class="hdr">
    <div>
      <div class="title"><span class="dot"></span>Bitcoin KPI</div>
      <div class="sub" id="status">Initialisiere…</div>
    </div>
    <button id="refresh">↻</button>
  </div>

  <div class="tabs">
    <button class="tab" data-vs="usd" aria-selected="true">USD</button>
    <button class="tab" data-vs="eur">EUR</button>
  </div>

  <div class="body">
    <div class="kpi">
      <div class="kpi-top">
        <div>
          <div class="sub" id="label">Kurs (USD)</div>
          <div class="price" id="price">—</div>
        </div>
        <div class="meta">
          <div class="row"><span>24h %</span><span id="pct" class="pill">—</span></div>
          <div class="row"><span>24h Δ</span><span id="abs" class="pill">—</span></div>
          <div class="sub">Quelle: Binance</div>
        </div>
      </div>
      <div class="chart"><canvas id="chart" width="1000" height="300"></canvas></div>
    </div>
  </div>

  <div class="foot">
    <div>Update: <span id="time">—</span></div>
    <div>Auto 15s</div>
  </div>
</section>

<script>
(() => {
const S={
  vs:"usd",fx:null,price:null,pct:null,abs:null,chart:[]
};
const el=id=>document.getElementById(id);
const sym=v=>v==="eur"?"€":"$";
const fmt=n=>new Intl.NumberFormat().format(n);
const fmt2=n=>n.toFixed(2);

async function fx(){
  const r=await fetch("https://api.exchangerate.host/latest?base=USD&symbols=EUR");
  const d=await r.json();
  S.fx=d?.rates?.EUR;
}

async function load(){
  el("status").textContent="Update…";
  const [t,k]=await Promise.all([
    fetch("https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT").then(r=>r.json()),
    fetch("https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h&limit=30").then(r=>r.json())
  ]);
  S.price=+t.lastPrice;
  S.pct=+t.priceChangePercent;
  S.abs=+t.priceChange;
  S.chart=k.map(r=>({t:+r[0],p:+r[4]}));
  el("time").textContent=new Date().toLocaleTimeString();
  el("status").textContent="Live";
  render();
}

function render(){
  const p=S.vs==="eur"&&S.fx?S.price*S.fx:S.price;
  const d=S.vs==="eur"&&S.fx?S.abs*S.fx:S.abs;
  el("price").textContent=sym(S.vs)+" "+fmt(Math.round(p));
  const pct=el("pct"),abs=el("abs");
  pct.textContent=(S.pct>=0?"+":"")+fmt2(S.pct)+"%";
  abs.textContent=(d>=0?"+":"")+sym(S.vs)+" "+fmt(Math.round(d));
  pct.className="pill "+(S.pct>=0?"good":"bad");
  abs.className="pill "+(d>=0?"good":"bad");
  draw();
  window.BTCWidget={getState:()=>({...S})};
}

function draw(){
  const c=el("chart"),x=c.getContext("2d");
  x.clearRect(0,0,c.width,c.height);
  if(S.chart.length<2)return;
  let min=Math.min(...S.chart.map(p=>p.p));
  let max=Math.max(...S.chart.map(p=>p.p));
  min*=0.98;max*=1.02;
  const X=i=>i/(S.chart.length-1)*c.width;
  const Y=v=>c.height-(v-min)/(max-min)*c.height;
  x.beginPath();
  S.chart.forEach((p,i)=>i?x.lineTo(X(i),Y(p.p)):x.moveTo(X(i),Y(p.p)));
  x.strokeStyle="rgba(255,255,255,.85)";
  x.lineWidth=2;x.stroke();
}

document.querySelectorAll(".tab").forEach(b=>{
  b.onclick=async()=>{
    document.querySelectorAll(".tab").forEach(x=>x.setAttribute("aria-selected","false"));
    b.setAttribute("aria-selected","true");
    S.vs=b.dataset.vs;
    el("label").textContent="Kurs ("+S.vs.toUpperCase()+")";
    if(S.vs==="eur"&&!S.fx) await fx();
    render();
  };
});
el("refresh").onclick=load;
load(); setInterval(load,15000);
})();
</script>
</body>
</html>